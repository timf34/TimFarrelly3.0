---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import SorollaGraphic from '../components/SorollaGraphic.astro';
import MobileNav from '../components/MobileNav.astro';
---

<Layout title="Tim Farrelly">

  <Header />

  <!-- Mobile Navigation -->
  <MobileNav currentPage="about" />

  <!-- Main Grid -->
  <main class="grid">
    
    <!-- Menu (centered in column 1) -->
    <nav class="col-menu">
      <ul>
        <li><strong>About</strong></li>
        <li><a href="/lists">Lists</a></li>
        <li><a href="/writing">Writing</a></li>
        <li><a href="/art">Art Gallery</a></li>
        <li><a href="/pics">Pics:)</a></li>
      </ul>
    </nav>

    <article class="col-content">
      <div class="content-inner">
        <p>
          I'm Tim, a founder and engineer exploring new technical frontiers. I'm very into <a href="/art">art</a>.
        </p>
        <p>
          I co-founded <a href="https://fov.ie/">Field of Vision</a> with my friends Omar and David. We build 
          haptic devices to transform the way blind fans watch sport (featured in Time Magazine's Best Inventions!). 
          I built everything software, AI and camera related. Over the past year I concurrently ran 
          <a href="https://joinpatch.org">Patch</a>, where we find and support Ireland's most talented youth. 
          I'm now in an advisory role at both.
        </p>
        <p>
          I co-founded <a href="https://hackireland.com">Hack Ireland</a>, the country's largest student hackathon, 
          and am now helping establish it as a sustainable student-led org. I also helped bring an underground 
          hacker meetup in Dublin to lifeâ€”if you know you know.
        </p>
        <p>
          Previously, I worked on AI safety research with researchers at Oxford and TCD, primarily focused on 
          cooperative AI. <a href="https://youtu.be/2S9t_jhZmP8?si=YZxdK6ulQyYTOLIw">See talk here</a>. 
          I'm focusing energy here again now. And I studied Computer Engineering at Trinity College Dublin.
        </p>
        <b>Contact:</b>
        <ul>
            <li><a href="https://github.com/timf34">GitHub</a> (lots of open source tools!)</li>
            <li><a href="https://www.linkedin.com/in/timfarrelly2000/">LinkedIn</a></li>
            <li><a href="https://www.instagram.com/tim_farrelly34/">Instagram</a></li>
            <li><a href="mailto:timf34@gmail.com">timf34@gmail.com</a></li>
        </ul>
      </div>
    </article>

    <!-- Artwork (centered in column 3) -->
    <aside class="col-art">
      <div class="art-frame">
        <canvas id="artwork"></canvas>
      </div>
    </aside>

  </main>

  <SorollaGraphic />

  <script>
    // Artwork
    import { getRandomArtwork } from '../artworks/index.js';
    
    const canvas = document.getElementById('artwork');
    if (canvas) {
      const resize = () => {
        const parent = canvas.parentElement;
        if (parent) {
          canvas.width = parent.clientWidth;
          canvas.height = parent.clientHeight;
        }
      };
      
      resize();
      window.addEventListener('resize', resize);
      
      // Start random artwork
      const artwork = getRandomArtwork();
      artwork(canvas);
    }

    // Center artwork vertically relative to text content
    function centerArtwork() {
      const artCol = document.querySelector('.col-art');
      const artFrame = document.querySelector('.art-frame');
      const contentCol = document.querySelector('.col-content');

      if (artCol && artFrame && contentCol) {
        const contentHeight = contentCol.offsetHeight;
        const artworkHeight = artFrame.offsetHeight;

        // Center artwork at the midpoint of the text content
        const paddingTop = Math.max(0, (contentHeight - artworkHeight) / 2);

        artCol.style.paddingTop = `${paddingTop}px`;
      }
    }

    // Ensure Sorolla painting peeks into viewport
    function ensureSorollaPeeks() {
      const mainGrid = document.querySelector('.grid') as HTMLElement;
      const sorollaContainer = document.querySelector('.sorolla-container') as HTMLElement;

      if (mainGrid && sorollaContainer) {
        // Reset min-height first to get natural position
        mainGrid.style.minHeight = '';

        const viewportHeight = window.innerHeight;
        const sorollaTop = sorollaContainer.getBoundingClientRect().top;
        const peekAmount = 80; // How many pixels of Sorolla to show

        // Where Sorolla should start (viewport bottom minus peek)
        const targetTop = viewportHeight - peekAmount;

        // If Sorolla is too high (too visible), push it down
        if (sorollaTop < targetTop) {
          const extraHeight = targetTop - sorollaTop;
          mainGrid.style.minHeight = `${mainGrid.offsetHeight + extraHeight}px`;
        }
      }
    }

    // Run after layout settles
    requestAnimationFrame(() => {
      centerArtwork();
      ensureSorollaPeeks();
    });
    window.addEventListener('resize', () => {
      centerArtwork();
      ensureSorollaPeeks();
    });
  </script>
</Layout>

<style>
  /* ===== GRID ===== */
  .grid {
    display: grid;
    grid-template-columns: 10% 40% 50%;
    align-items: start;
    padding-bottom: 4rem;
  }

  /* Menu - column 1, centered */
  .col-menu {
    grid-column: 1;
    display: flex;
    justify-content: center;
  }

  .col-menu ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .col-menu li {
    margin-bottom: 0.5rem;
  }

  .col-menu a {
    text-decoration: none;
  }

  .col-menu a:hover {
    text-decoration: underline;
  }

  /* Content - column 2, centered */
  .col-content {
    grid-column: 2;
    display: flex;
    justify-content: center;
    min-height: 450px; /* Fixed height for consistent artwork positioning across pages */
  }

  .content-inner {
    width: 85%;
  }

  .content-inner p {
    margin: 0 0 1.25rem;
  }

  .content-inner ul {
    margin: 0 0 1.25rem;
    padding-left: 1.25rem;
  }

  .content-inner li {
    margin-bottom: 0.5rem;
  }

  /* Artwork - column 3, centered */
  .col-art {
    grid-column: 3;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding-top: 0; /* JS will set this */
    /* background: rgba(255, 0, 0, 0.1);  Visualisation for debugging */
  }

  .art-frame {
    width: 100%;
    max-width: 400px;
    aspect-ratio: 1 / 1;
    border: 1px solid rgba(14, 32, 47, 0.15);
    background: #e6e1d4;
    overflow: hidden;
  }

  /* ===== MOBILE ===== */
  @media (max-width: 900px) {
    .grid {
      display: block;
      padding: 0 1.5rem 3rem;
    }

    .col-menu {
      display: none;
    }

    .col-content {
      justify-content: flex-start;
      margin-bottom: 2rem;
    }

    .content-inner {
      width: 100%;
    }

    .col-art {
      display: none;
    }
  }
</style>