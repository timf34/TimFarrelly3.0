---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import MobileNav from '../components/MobileNav.astro';

// Paintings data — images served locally as WebP from /paintings/
const paintings = [
  { slug: "isle-of-the-dead", title: "The Isle of the Dead", artist: "Arnold Bocklin" },
  { slug: "carnation-lily-lily-rose", title: "Carnation, Lily, Lily Rose", artist: "John Singer Sargent" },
  { slug: "two-men-contemplating-the-moon", title: "Two Men Contemplating the Moon", artist: "Caspar David Friedrich" },
  { slug: "achill-horses", title: "Achill Horses", artist: "Mainie Jellett" },
  { slug: "vertumnus", title: "Vertumnus", artist: "Giuseppe Arcimboldo" },
  { slug: "course-of-empire-destruction", title: "The Course of Empire: Destruction", artist: "Thomas Cole" },
  { slug: "winter-landscape", title: "Winter Landscape", artist: "Caspar David Friedrich" },
  { slug: "singing-horseman", title: "Singing Horseman", artist: "J.B. Yeats" },
  { slug: "hope", title: "Hope", artist: "George Frederic Watts" },
  { slug: "rokeby-venus", title: "Rokeby Venus", artist: "Velazquez" },
  { slug: "on-board-a-sailing-ship", title: "On Board a Sailing Ship", artist: "Caspar David Friedrich" },
  { slug: "nighthawks", title: "Nighthawks", artist: "Edward Hopper" },
  { slug: "springtime", title: "Springtime", artist: "Claude Monet" },
  { slug: "the-morning", title: "The Morning", artist: "Caspar David Friedrich" },
  { slug: "the-monk-by-the-sea", title: "The Monk by the Sea", artist: "Caspar David Friedrich" },
  { slug: "self-portrait-with-death", title: "Self Portrait with Death Playing The Fiddle", artist: "Arnold Bocklin" },
  { slug: "one-no-31", title: "One: No. 31", artist: "Jackson Pollock" },
  { slug: "ulysses-deriding-polyphemus", title: "Ulysses Deriding Polyphemus", artist: "JMW Turner" },
  { slug: "ulysses-and-the-sirens", title: "Ulysses and the Sirens", artist: "John William Waterhouse" },
  { slug: "nude-binding-her-hair", title: "Nude Binding Her Hair", artist: "Koide Narashige" },
  { slug: "overflow", title: "Overflow", artist: "Andrew Wyeth" },
  { slug: "the-mountain-mists", title: "The Mountain Mists", artist: "Herbert James Draper" },
  { slug: "pieta", title: "Pieta", artist: "Mainie Jellett" },
  { slug: "new-york-movie", title: "New York Movie", artist: "Edward Hopper" },
  { slug: "the-lovers", title: "The Lovers", artist: "Rene Magritte" },
  { slug: "fountain-of-inspiration", title: "The Fountain of Inspiration", artist: "Constant Montald" },
  { slug: "nude-1916", title: "Nude (1916)", artist: "Amedeo Modigliani" },
  { slug: "satans-treasures", title: "Satan's Treasures", artist: "Jean Delville" },
  { slug: "engloutissement", title: "Engloutissement", artist: "André Masson" },
  { slug: "october", title: "October", artist: "Jules Bastien-Lepage" },
  { slug: "experiment-bird-air-pump", title: "An Experiment on a Bird in the Air Pump", artist: "Joseph Wright" },
  { slug: "sadko", title: "Sadko", artist: "Ilya Repin" },
  { slug: "covent-garden-brittany", title: "A Covent Garden, Brittany", artist: "William Leech" },
  { slug: "pandora", title: "Pandora", artist: "Odilon Redon" },
  { slug: "morning-glazunov", title: "Morning", artist: "Ilya Glazunov" },
  { slug: "pygmalion-and-galatea", title: "Pygmalion and Galatea", artist: "Jean-Leon Gerome" },
  { slug: "voyage-of-life-childhood", title: "The Voyage of Life: Childhood", artist: "Thomas Cole" },
  { slug: "voyage-of-life-youth", title: "The Voyage of Life: Youth", artist: "Thomas Cole" },
  { slug: "voyage-of-life-manhood", title: "The Voyage of Life: Manhood", artist: "Thomas Cole" },
  { slug: "voyage-of-life-old-age", title: "The Voyage of Life: Old Age", artist: "Thomas Cole" },
  { slug: "bal-tabarin", title: "Bal Tabarin", artist: "Jan Sluijters" },
  { slug: "le-ballet", title: "Le Ballet", artist: "Gaston La Touche" },
  { slug: "mr-gilhooley-geneva-window", title: "'Mr Gilhooley by Liam O'Flaherty' for the Geneva Window", artist: "Harry Clarke" },
  { slug: "opus-217-felix-feneon", title: "Opus 217. Against the Enamel of a Background Rhythmic with Beats and Angles, Tones, and Tints, Portrait of M. Félix Fénéon in 1890", artist: "Paul Signac" },
  { slug: "sunflowers-petrol-station", title: "Sunflowers from Petrol Station", artist: "Banksy" },
  { slug: "atem-breath", title: "Atem (Breath)", artist: "Gerhard Richter" },
  { slug: "siesta", title: "Siesta", artist: "Pierre Bonnard" },
  { slug: "the-ball", title: "The Ball", artist: "Gaston La Touche" },
  { slug: "susanna-at-her-bath", title: "Susanna at her Bath", artist: "Francesco Hayez" },
  { slug: "lament-for-icarus", title: "The Lament for Icarus", artist: "Herbert James Draper" },
  { slug: "ariadne", title: "Ariadne", artist: "John Lavery" },
  { slug: "graceful-ascent", title: "Graceful Ascent", artist: "Vasily Kandinsky" },
  { slug: "of-lilies-and-remains", title: "Of Lilies and Remains", artist: "Richard Mosse" },
  { slug: "in-morocco", title: "In Morocco", artist: "John Lavery" },
  { slug: "catherine-and-midnight", title: "Catherine and Midnight", artist: "Takako Yamaguchi" },
  { slug: "the-chess-game", title: "The Chess Game", artist: "John Singer Sargent" },
  { slug: "the-truth", title: "The Truth", artist: "Jules Lefebvre" },
  { slug: "bernard-and-roger", title: "Bernard and Roger, at the château de Vineuil at Bourré", artist: "Louis-Maurice Boutet De Monvel" },
  { slug: "knight-of-the-flowers", title: "The Knight of the Flowers", artist: "Georges Rochegrosse" },
  { slug: "anguish", title: "Anguish", artist: "August Friedrich Schenck" },
  { slug: "twins", title: "Twins", artist: "Maurice Boutet de Monvel" },
  { slug: "how-to-entangle-the-universe-in-a-spiderweb", title: "How to Entangle the Universe in a Spiderweb", artist: "Tomás Saraceno" },
  { slug: "alberi-libro", title: "Alberi Libro (Book Trees)", artist: "Giuseppe Penone" },
  { slug: "among-the-olive-trees-capri", title: "Among the Olive Trees, Capri", artist: "John Singer Sargent" },
  { slug: "dove", title: "Dove", artist: "Conor Fallon" },
];

---

<Layout title="Art Gallery | Tim Farrelly">

  <Header />

  <!-- Mobile Navigation -->
  <MobileNav currentPage="art" />

  <!-- Main Content -->
  <main class="grid">
    <!-- Menu -->
    <nav class="col-menu">
      <ul>
        <li><a href="/">About</a></li>
        <li><a href="/lists">Lists</a></li>
        <li><a href="/writing">Writing</a></li>
        <li><strong>Art Gallery</strong></li>
        <li><a href="/pics">Pics:)</a></li>
      </ul>
    </nav>

    <!-- Gallery -->
    <div class="gallery-container">
      {paintings.map((painting, index) => (
        <figure data-index={index}>
          <img
            src={`/paintings/${painting.slug}-thumb.webp`}
            data-original={`/paintings/${painting.slug}.webp`}
            alt={`${painting.title} by ${painting.artist}`}
            loading="lazy"
          />
          <figcaption>
            <span class="title">{painting.title}</span>
            <span class="artist">by {painting.artist}</span>
          </figcaption>
        </figure>
      ))}
    </div>
  </main>

  <!-- Modal -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <button class="close-btn" aria-label="Close">&times;</button>
      <button class="nav-btn prev-btn" aria-label="Previous">&#10094;</button>
      <img id="modal-image" src="" alt="" />
      <button class="nav-btn next-btn" aria-label="Next">&#10095;</button>
      <div class="modal-caption">
        <span id="modal-title"></span>
        <span id="modal-artist"></span>
      </div>
    </div>
  </div>

  <script>
    // Modal functionality
    const modal = document.getElementById('modal') as HTMLDivElement;
    const modalImage = document.getElementById('modal-image') as HTMLImageElement;
    const modalTitle = document.getElementById('modal-title') as HTMLSpanElement;
    const modalArtist = document.getElementById('modal-artist') as HTMLSpanElement;
    const closeBtn = document.querySelector('.close-btn') as HTMLButtonElement;
    const prevBtn = document.querySelector('.prev-btn') as HTMLButtonElement;
    const nextBtn = document.querySelector('.next-btn') as HTMLButtonElement;
    const figures = document.querySelectorAll('figure');

    let currentIndex = 0;

    // Easter egg: Isle of the Dead audio
    const isleOfTheDeadIndex = 0; // First painting in the array
    let isleAudio: HTMLAudioElement | null = null;

    function playIsleOfTheDeadMusic() {
      if (!isleAudio) {
        isleAudio = new Audio('/audio/isle_of_the_dead_96k.mp3');
        isleAudio.loop = true;
      }
      isleAudio.play().catch(() => {
        // Autoplay may be blocked by browser, that's ok
      });
    }

    function stopIsleOfTheDeadMusic() {
      if (isleAudio) {
        isleAudio.pause();
        isleAudio.currentTime = 0;
      }
    }

    function openModal(index: number) {
      currentIndex = index;
      const figure = figures[index];
      const img = figure.querySelector('img') as HTMLImageElement;
      const title = figure.querySelector('.title')?.textContent || '';
      const artist = figure.querySelector('.artist')?.textContent || '';

      modalImage.src = img.dataset.original || img.src;
      modalTitle.textContent = title;
      modalArtist.textContent = artist;
      modal.style.display = 'flex';
      document.body.style.overflow = 'hidden';

      // Easter egg: play music for Isle of the Dead
      if (index === isleOfTheDeadIndex) {
        playIsleOfTheDeadMusic();
      } else {
        stopIsleOfTheDeadMusic();
      }
    }

    function closeModal() {
      modal.style.display = 'none';
      document.body.style.overflow = '';
      stopIsleOfTheDeadMusic();
    }

    function navigate(direction: number) {
      currentIndex = (currentIndex + direction + figures.length) % figures.length;
      openModal(currentIndex);
    }

    // Event listeners
    figures.forEach((figure, index) => {
      figure.addEventListener('click', () => openModal(index));
    });

    closeBtn.addEventListener('click', closeModal);
    prevBtn.addEventListener('click', () => navigate(-1));
    nextBtn.addEventListener('click', () => navigate(1));

    modal.addEventListener('click', (e) => {
      if (e.target === modal) closeModal();
    });

    document.addEventListener('keydown', (e) => {
      if (modal.style.display !== 'flex') return;
      if (e.key === 'Escape') closeModal();
      if (e.key === 'ArrowLeft') navigate(-1);
      if (e.key === 'ArrowRight') navigate(1);
    });
  </script>
</Layout>

<style>
  /* ===== GRID ===== */
  .grid {
    display: grid;
    grid-template-columns: 10% 1fr;
    padding-bottom: 4rem;
  }

  /* Menu - column 1, centered */
  .col-menu {
    grid-column: 1;
    display: flex;
    justify-content: center;
  }

  .col-menu ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .col-menu li {
    margin-bottom: 0.5rem;
  }

  .col-menu a {
    text-decoration: none;
  }

  .col-menu a:hover {
    text-decoration: underline;
  }

  /* ===== GALLERY ===== */
  .gallery-container {
    grid-column: 2;
    column-count: 4;
    column-gap: 12px;
    padding-right: 2rem;
  }

  figure {
    margin: 0 0 4px 0;
    break-inside: avoid;
    cursor: pointer;
  }

  figure img {
    width: 100%;
    display: block;
    transition: all 0.3s ease;
  }

  figure:hover img {
    opacity: 0.85;
    transform: scale(1.01);
    box-shadow: 0 0 12px rgba(180, 100, 180, 0.5);
  }

  figcaption {
    padding: 0.15rem 0 0.1rem 0;
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .title {
    font-size: 0.85rem;
    color: #0e202f;
    font-style: italic;
    line-height: 1.2;
  }

  .artist {
    font-size: 0.75rem;
    color: rgba(14, 32, 47, 0.6);
    margin-top: -2px;
  }

  /* ===== MODAL ===== */
  .modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.9);
    z-index: 1000;
    justify-content: center;
    align-items: center;
  }

  .modal-content {
    position: relative;
    max-width: 95vw;
    max-height: 95vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  #modal-image {
    max-width: 90vw;
    max-height: 85vh;
    object-fit: contain;
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
    animation: modalFadeIn 0.3s ease;
  }

  @keyframes modalFadeIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
  }

  .modal-caption {
    margin-top: 1rem;
    text-align: center;
    color: white;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  #modal-title {
    font-size: 1.1rem;
    font-style: italic;
  }

  #modal-artist {
    font-size: 0.9rem;
    opacity: 0.7;
  }

  .close-btn {
    position: fixed;
    top: 1rem;
    right: 1.5rem;
    background: none;
    border: none;
    color: white;
    font-size: 2.5rem;
    cursor: pointer;
    opacity: 0.7;
    transition: opacity 0.2s;
    z-index: 1001;
  }

  .close-btn:hover {
    opacity: 1;
  }

  .nav-btn {
    position: fixed;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: white;
    font-size: 2rem;
    padding: 1rem 0.75rem;
    cursor: pointer;
    opacity: 0.7;
    transition: all 0.2s;
    z-index: 1001;
  }

  .nav-btn:hover {
    opacity: 1;
    background: rgba(180, 100, 180, 0.3);
  }

  .prev-btn {
    left: 1rem;
  }

  .next-btn {
    right: 1rem;
  }

  /* ===== RESPONSIVE ===== */
  @media (min-width: 1601px) {
    .gallery-container {
      column-count: 5;
    }
  }

  @media (max-width: 1200px) {
    .gallery-container {
      column-count: 3;
    }
  }

  @media (max-width: 900px) {
    .grid {
      display: block;
      padding: 0 1.5rem 3rem;
    }

    .col-menu {
      display: none;
    }

    .gallery-container {
      column-count: 2;
      padding: 0;
    }

    .nav-btn {
      font-size: 1.5rem;
      padding: 0.75rem 0.5rem;
    }
  }

  @media (max-width: 500px) {
    .gallery-container {
      column-count: 2;
      column-gap: 8px;
    }

    figure {
      margin-bottom: 8px;
    }

    .title {
      font-size: 0.75rem;
    }

    .artist {
      font-size: 0.65rem;
    }
  }
</style>
